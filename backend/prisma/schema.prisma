// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  password  String
  number String
  refreshToken String? @unique //optional refresh token for authentication, can be nulll -> when present must be unique
  createdAt DateTime @default(now()) //auto-set to current time when user is created

  // Relationships
  onRampTxns OnRampTx[]
  balances Balance?
}

//User's wallet balance
model Balance {
  id Int @id @default(autoincrement())
  userId Int @unique
  amount Int  @default(0) // available balance
  locked Int @default(0)//Money in pending transactions
  user User @relation(fields: [userId], references: [id])
  lastUpdated DateTime @updatedAt
}

//adding money from bank
model OnRampTx {
  id Int @id @default(autoincrement())
  token String @unique // Unique identifier form payment provider
  //Tx Status
  status OnRampStatus @default(Processing)

  //Financial Details
  amount Int

  //Payment Provider Details
  provider String //"HDFC" "SBI"

  //Timeline Details
  startTime DateTime @default(now()) //When user initiated

  // Relationship
  userId Int
  user User @relation(fields: [userId], references: [id])
}

// Enums for better type safety
enum OnRampStatus {
  Processing
  Success
  Failed
}

// Run migration
// npx prisma migrate dev --name init
// npx prisma studio