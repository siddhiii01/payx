// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  password  String
  number String
  refreshToken String? @unique //optional refresh token for authentication, can be nulll -> when present must be unique
  createdAt DateTime @default(now()) //auto-set to current time when user is created

  // Relationships
  onRampTxns OnRampTx[]
  balances Balance? //why keep balance as optional -> if no bal set to 0
  //here i got error when i kept Balance -> prisma error why?

  bills Bills[]
  transactions Transaction[]
}

//User's wallet balance
model Balance {
  id Int @id @default(autoincrement())
  userId Int @unique
  amount Int  @default(0) // available balance
  locked Int @default(0)//Money in pending transactions
  user User @relation(fields: [userId], references: [id])
  lastUpdated DateTime @updatedAt
}

//adding money from bank
model OnRampTx {
  id Int @id @default(autoincrement())
  token String @unique // Unique identifier form payment provider
  //Tx Status
  status OnRampStatus @default(Processing)

  //Financial Details
  amount Int

  //Payment Provider Details
  provider String //"HDFC" "SBI"

  //Timeline Details
  startTime DateTime @default(now()) //When user initiated

  // Relationship
  userId Int
  user User @relation(fields: [userId], references: [id])
}


model Billers{
  id Int @id @default(autoincrement())
  name String
  category BillersCategory
  createdAt DateTime @default(now())

  bills Bills[] //bills that user owe to this provider
  transactions Transaction[] //payment user attempted toward this provider
}

model Bills{
  id Int @id @default(autoincrement())
  amount Int //amount of the bill
  dueDate DateTime //When should user pay by
  // accountNumber - How do you link it to user's account with that biller? -> why ??
  accountNumber String
  status BillStatus @default(pending)
  createdAt DateTime @default(now())

  userId Int
  billerId Int //to know which company the bill is for
 
  transaction Transaction[] //i did not understand this
  user User @relation(fields: [userId], references: [id])
  biller Billers @relation(fields: [billerId], references: [id])
}

model Transaction{
  id Int @id @default(autoincrement())
  amount Int
  status TransactionStatus
  createdAt DateTime @default(now())

  billId Int //Which bill was paid?
  userId Int
  billerId Int

  bill Bills @relation(fields: [billId], references: [id])
  user User @relation(fields: [userId], references: [id])
  biller Billers @relation(fields: [billerId], references: [id])
}

// Enums for better type safety
enum OnRampStatus {
  Processing
  Success
  Failed
}

enum BillersCategory {
  Electricity
  Recharge
  Water
}

enum BillStatus {
  pending
  paid
}

enum TransactionStatus {
  success
  failed
}

// Run migration
// npx prisma migrate dev --name init -> don't run this in prisma folder
// npx prisma studio
//npx prisma migrate reset
